<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>January | 2005 | mind the explanatory gap</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
		<!--[if lt IE 9]>
	<script src="http://explanatorygap.net/wp-content/themes/twentythirteen/js/html5.js"></script>
	<![endif]-->
	<link rel="alternate" type="application/rss+xml" title="mind the explanatory gap &raquo; Feed" href="http://explanatorygap.net/wp-content/plugins/really-static/static/feed/" />

<link rel='stylesheet' id='wpcf-css'  href='http://explanatorygap.net/wp-content/plugins/wp-contact-form/wpcf.css?ver=20110218' type='text/css' media='all' />
<link rel='stylesheet' id='twentythirteen-fonts-css'  href='//fonts.googleapis.com/css?family=Source+Sans+Pro%3A300%2C400%2C700%2C300italic%2C400italic%2C700italic%7CBitter%3A400%2C700&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='http://explanatorygap.net/wp-content/themes/twentythirteen/fonts/genericons.css?ver=2.09' type='text/css' media='all' />
<link rel='stylesheet' id='twentythirteen-style-css'  href='http://explanatorygap.net/wp-content/themes/twentythirteen/style.css?ver=2013-07-18' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentythirteen-ie-css'  href='http://explanatorygap.net/wp-content/themes/twentythirteen/css/ie.css?ver=2013-07-18' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='http://explanatorygap.net/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://explanatorygap.net/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://explanatorygap.net/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.7.3'></script>
<meta name="generator" content="WordPress 3.9.1 - really-static 0.5" />
<link rel="stylesheet" href="http://explanatorygap.net/wp-content/plugins/source-code-syntax-highlighting-plugin-for-wordpress/geshi.css"  type="text/css" />	<style type="text/css" id="twentythirteen-header-css">
			.site-header {
			background: url(http://explanatorygap.net/wp-content/themes/twentythirteen/images/headers/star.png) no-repeat scroll top;
			background-size: 1600px auto;
		}
		</style>
	<!-- Google Analytics Tracking by Google Analyticator 6.4.7.3: http://www.videousermanuals.com/google-analyticator/ -->
<script type="text/javascript">
                var analyticsFileTypes = [''];
                            var analyticsSnippet = 'enabled';
                var analyticsEventTracking = 'enabled';
            </script>
<script type="text/javascript">
	var _gaq = _gaq || [];
  
	_gaq.push(['_setAccount', 'UA-719433-1']);
    _gaq.push(['_addDevId', 'i9k95']); // Google Analyticator App ID with Google
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</head>

<body class="archive date single-author">
	<div id="page" class="hfeed site">
		<header id="masthead" class="site-header" role="banner">
			<a class="home-link" href="http://explanatorygap.net/wp-content/plugins/really-static/static/" title="mind the explanatory gap" rel="home">
				<h1 class="site-title">mind the explanatory gap</h1>
				<h2 class="site-description">many a slip &#039;twixt mind and lip&#8230;</h2>
			</a>

			<div id="navbar" class="navbar">
				<nav id="site-navigation" class="navigation main-navigation" role="navigation">
					<h3 class="menu-toggle">Menu</h3>
					<a class="screen-reader-text skip-link" href="#content" title="Skip to content">Skip to content</a>
					<div class="nav-menu"><ul><li class="page_item page-item-2"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/about/">About/Contact</a></li><li class="page_item page-item-278"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/os-x-puppet-pkgs/">OS X Puppet pkgs</a></li></ul></div>
					<form role="search" method="get" class="search-form" action="http://explanatorygap.net/wp-content/plugins/really-static/static/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" title="Search for:" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form>				</nav><!-- #site-navigation -->
			</div><!-- #navbar -->
		</header><!-- #masthead -->

		<div id="main" class="site-main">

	<div id="primary" class="content-area">
		<div id="content" class="site-content" role="main">

					<header class="archive-header">
				<h1 class="archive-title">Monthly Archives: January 2005</h1>
			</header><!-- .archive-header -->

										
<article id="post-125" class="post-125 post type-post status-publish format-standard hentry category-uncategorized">
	<header class="entry-header">
		
				<h1 class="entry-title">
			<a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2005/01/20/compiling-php-with-aspell-support/" rel="bookmark">compiling PHP with aspell support</a>
		</h1>
		
		<div class="entry-meta">
			<span class="date"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2005/01/20/compiling-php-with-aspell-support/" title="Permalink to compiling PHP with aspell support" rel="bookmark"><time class="entry-date" datetime="2005-01-20T00:27:53+00:00">January 20, 2005</time></a></span><span class="categories-links"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span><span class="author vcard"><a class="url fn n" href="http://explanatorygap.net/wp-content/plugins/really-static/static/author/nigelkersten/" title="View all posts by nigel kersten" rel="author">nigel kersten</a></span>					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		<p>I was banging my head against a brick wall trying to get <a href="http://aspell.sourceforge.net/">aspell</a> support working with PHP.<br />
<br />
The php module make stage kept failing with errors like:</p>
<pre>
ld: ext/pspell/pspell.o illegal reference to symbol: 
_aspell_error_number defined in indirectly referenced  
dynamic library /usr/local/lib/libaspell.15.dylib
</pre>
<p>Turns out this is a <a href="http://bugs.php.net/bug.php?id=29554">known bug</a> to do with aspell and php under OS X.<br />
<br />
The fix is quite simple.<br />
<br />
Before you attempt to run &#8220;./configure &#8211;whatever&#8221; for php, edit the &#39;configure&#39; file inside the php source folder, and look for the line:</p>
<pre>
LIBS="-lpspell $LIBS
</pre>
<p>Change it so that it looks like:</p>
<pre>
LIBS="-laspell -lpspell $LIBS"
</pre>
<p>and bob&#39;s your uncle.</p>
			</div><!-- .entry-content -->
	
	<footer class="entry-meta">
					<div class="comments-link">
				<a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2005/01/20/compiling-php-with-aspell-support/#respond" title="Comment on compiling PHP with aspell support"><span class="leave-reply">Leave a comment</span></a>			</div><!-- .comments-link -->
		
			</footer><!-- .entry-meta -->
</article><!-- #post -->
							
<article id="post-126" class="post-126 post type-post status-publish format-standard hentry category-uncategorized">
	<header class="entry-header">
		
				<h1 class="entry-title">
			<a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2005/01/19/converting-man-pages-to-text/" rel="bookmark">Converting man pages to text&#8230;</a>
		</h1>
		
		<div class="entry-meta">
			<span class="date"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2005/01/19/converting-man-pages-to-text/" title="Permalink to Converting man pages to text&#8230;" rel="bookmark"><time class="entry-date" datetime="2005-01-19T21:53:50+00:00">January 19, 2005</time></a></span><span class="categories-links"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span><span class="author vcard"><a class="url fn n" href="http://explanatorygap.net/wp-content/plugins/really-static/static/author/nigelkersten/" title="View all posts by nigel kersten" rel="author">nigel kersten</a></span>					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		<p>I&#39;ve beeing using groff to nicely format man pages to plain text like so:</p>
<pre>
groff -mandoc -Tascii  /usr/share/man/man1/ps.1 &gt; man_ps.txt
</pre>
<p>but the problem is that you need to find the actual man page file, which adds another step to the process. This tip landed in my inbox the other day from the Unix Guru Universe <a href="http://www.ugu.com/sui/ugu/show?tip.today">Hot Tip of the Day</a> list.</p>
<p>To convert a man page to text, simply do:</p>
<pre>
man ps | col -b &gt; man_ps.txt
</pre>
<p>Much easier than messing around with groff and the mandoc options.<br />
<br />
groff is still more useful for doing stuff like exporting to straight html like:</p>
<pre>
groff -mandoc -Thtml  /usr/share/man/man1/ps.1
</pre>
			</div><!-- .entry-content -->
	
	<footer class="entry-meta">
					<div class="comments-link">
				<a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2005/01/19/converting-man-pages-to-text/#respond" title="Comment on Converting man pages to text&#8230;"><span class="leave-reply">Leave a comment</span></a>			</div><!-- .comments-link -->
		
			</footer><!-- .entry-meta -->
</article><!-- #post -->
							
<article id="post-127" class="post-127 post type-post status-publish format-standard hentry category-uncategorized">
	<header class="entry-header">
		
				<h1 class="entry-title">
			<a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2005/01/14/blojsom-and-open-directory-authentication/" rel="bookmark">blojsom and Open Directory authentication.</a>
		</h1>
		
		<div class="entry-meta">
			<span class="date"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2005/01/14/blojsom-and-open-directory-authentication/" title="Permalink to blojsom and Open Directory authentication." rel="bookmark"><time class="entry-date" datetime="2005-01-14T00:17:36+00:00">January 14, 2005</time></a></span><span class="categories-links"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a></span><span class="author vcard"><a class="url fn n" href="http://explanatorygap.net/wp-content/plugins/really-static/static/author/nigelkersten/" title="View all posts by nigel kersten" rel="author">nigel kersten</a></span>					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		<p>You may have heard about the upcoming integration of <a href="http://wiki.blojsom.com/wiki/display/blojsom/About+blojsom">blojsom</a> in <a href="http://www.apple.com/server/macosx/tiger/">Tiger Server</a> when it comes out.<br />
I really like blojsom, and have been running it for a while now. It is far easier to administer for multi-user and multi-blog setups than anything else I&#39;ve experimented with, and offers some awesome <a href="http://wiki.blojsom.com/wiki/display/blojsom/Features">features</a>.</p>
<p>Well, recently an LDAP authentication plugin has been contributed to blojsom, which means that right now you can install it and set up blogs for your Open Directory users such that they authenticate using their OD username and password.  Installing and configuring all of this is a little bit of work, especially if you haven&#39;t set up Tomcat on your OS X Server box yet, but hopefully the step by step instructions will make it easy enough.</p>
<pre>
mkdir ~/blojsom_files
cd ~/blojsom_files
curl -O http://optusnet.dl.sourceforge.net/sourceforge/blojsom/blojsom.war
curl -O http://optusnet.dl.sourceforge.net/sourceforge/blojsom/blojsom-2.22-addons.zip
unzip blojsom-2.22-addons.zip
</pre>
<p>if you can&#39;t get to that direct download link, or want to use a SourceForge mirror closer to you, go to the following two links:</p>
<p><a href="http://prdownloads.sourceforge.net/blojsom/blojsom.war?download">http://prdownloads.sourceforge.net/blojsom/blojsom.war?download</a><br />
<br />
<a href="http://prdownloads.sourceforge.net/blojsom/blojsom-2.22-addons.zip?download">http://prdownloads.sourceforge.net/blojsom/blojsom-2.22-addons.zip?download</a></p>
<p><b>Step 1: Configuring blojsom.</b></p>
<pre>
sudo mkdir /Library/Tomcat/webapps/blojsom
cd /Library/Tomcat/webapps/blojsom
sudo jar xvf ~/blojsom_files/blojsom.war
sudo cp ~/blojsom_files/radeox-1.0b2.jar /Library/Tomcat/webapps/blojsom/WEB-INF/lib/
sudo cp ~/blojsom_files/blojsom-addon-core-2.22.jar /Library/Tomcat/webapps/blojsom/WEB-INF/lib/
sudo cp ~/blojsom_files/netscape-ldapjdk-4.17.jar /Library/Tomcat/webapps/blojsom/WEB-INF/lib/
</pre>
<p>Now edit the file:</p>
<pre>/Library/Tomcat/webapps/blojsom/WEB-INF/blojsom.properties</pre>
<p>and change:</p>
<pre>
blojsom-authorization-provider=org.blojsom.authorization.PropertiesAuthorizationProvider
</pre>
<p>to:</p>
<pre>
blojsom-authorization-provider=org.blojsom.authorization.LDAPAuthorizationProvider
</pre>
<p>and</p>
<pre>
blojsom-blog-home={user.home}/blojsom-blogs/
</pre>
<p>to:</p>
<pre>
blojsom-blog-home=/usr/local/blog-data/
</pre>
<p>Now edit
<pre>/Library/Tomcat/webapps/blojsom/WEB-INF/web.xml</pre>
<p>insert the following text into each servlet entry that you wish to use LDAP authentication for:</p>
<pre>
&lt;init-param&gt;
    &lt;param-name&gt;blog-ldap-authorization-server&lt;/param-name&gt;
    &lt;param-value&gt;DNS/IP Address of your LDAP server&lt;/param-value&gt;
&lt;/init-param&gt;
&lt;init-param&gt;
    &lt;param-name&gt;blog-ldap-authorization-dn&lt;/param-name&gt;
    &lt;param-value&gt;DN of your Open Directory User branch&lt;/param-value&gt;
&lt;/init-param&gt;
</pre>
<p>ie, say your Open Directory master is &#8220;odmaster.mydomain.com&#8221;, it is more than likely that your OD User branch is something like &#8220;cn=users,dc=mydomain,dc=com&#8221;, so it would look like:</p>
<pre>
&lt;init-param&gt;
    &lt;param-name&gt;blog-ldap-authorization-server&lt;/param-name&gt;
    &lt;param-value&gt;odmaster.mydomain.com&lt;/param-value&gt;
&lt;/init-param&gt;
&lt;init-param&gt;
    &lt;param-name&gt;blog-ldap-authorization-dn&lt;/param-name&gt;
    &lt;param-value&gt;cn=users,dc=mydomain,dc=com&lt;/param-value&gt;
&lt;/init-param&gt;
</pre>
<p>so, at a minimum, you&#39;ll want to set up LDAP authentication for the main blojsom servlet.<br />
Look for the lines:</p>
<pre>
    &lt;servlet&gt;
        &lt;servlet-name&gt;blojsom&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.blojsom.servlet.BlojsomServlet&lt;/servlet-class&gt;
</pre>
<p>and insert your LDAP configuration from above just after this, like so:</p>
<pre>
    &lt;servlet&gt;
        &lt;servlet-name&gt;blojsom&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.blojsom.servlet.BlojsomServlet&lt;/servlet-class&gt;
&lt;init-param&gt;
    &lt;param-name&gt;blog-ldap-authorization-server&lt;/param-name&gt;
    &lt;param-value&gt;odmaster.mydomain.com&lt;/param-value&gt;
&lt;/init-param&gt;
&lt;init-param&gt;
    &lt;param-name&gt;blog-ldap-authorization-dn&lt;/param-name&gt;
    &lt;param-value&gt;cn=users,dc=mydomain,dc=com&lt;/param-value&gt;
&lt;/init-param&gt;
</pre>
<p>If you&#39;re planning on using the <a href="http://wiki.blojsom.com/wiki/pages/viewpage.action?pageId=167">XML-RPC API</a> of blojsom so that you can use the Blogger, MetaWeblog and MovableType APIs, you&#39;ll also want to add the LDAP configuration to the appropriate servlet.</p>
<p>Look for the lines:</p>
<pre>
    &lt;servlet&gt;
        &lt;servlet-name&gt;blojsomxmlrpc&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.blojsom.extension.xmlrpc.BlojsomXMLRPCServlet&lt;/servlet-class&gt;
        </pre>
<p>and insert your LDAP configuration just after, like so:</p>
<pre>
    &lt;servlet&gt;
        &lt;servlet-name&gt;blojsomxmlrpc&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.blojsom.extension.xmlrpc.BlojsomXMLRPCServlet&lt;/servlet-class&gt;
&lt;init-param&gt;
    &lt;param-name&gt;blog-ldap-authorization-server&lt;/param-name&gt;
    &lt;param-value&gt;odmaster.mydomain.com&lt;/param-value&gt;
&lt;/init-param&gt;
&lt;init-param&gt;
    &lt;param-name&gt;blog-ldap-authorization-dn&lt;/param-name&gt;
    &lt;param-value&gt;cn=users,dc=mydomain,dc=com&lt;/param-value&gt;
&lt;/init-param&gt;
</pre>
<p>If you&#39;re planning on using the <a href="http://wiki.blojsom.com/wiki/display/blojsom/Atom+API"> Atom API</a> then add your LDAP config to the to Atom servlet:</p>
<p>Look for the lines:</p>
<pre>
    &lt;servlet&gt;
        &lt;servlet-name&gt;blojsomatomapi&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.blojsom.extension.atomapi.AtomAPIServlet&lt;/servlet-class&gt;
        </pre>
<p>and again, insert your LDAP configuration just after it, like so:</p>
<pre>
    &lt;servlet&gt;
        &lt;servlet-name&gt;blojsomatomapi&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.blojsom.extension.atomapi.AtomAPIServlet&lt;/servlet-class&gt;
&lt;init-param&gt;
    &lt;param-name&gt;blog-ldap-authorization-server&lt;/param-name&gt;
    &lt;param-value&gt;odmaster.mydomain.com&lt;/param-value&gt;
&lt;/init-param&gt;
&lt;init-param&gt;
    &lt;param-name&gt;blog-ldap-authorization-dn&lt;/param-name&gt;
    &lt;param-value&gt;cn=users,dc=mydomain,dc=com&lt;/param-value&gt;
&lt;/init-param&gt;
</pre>
<p>The comments servlet doesn&#39;t do authentication, so we don&#39;t need to modify it.</p>
<p>We need to set up an area for blog data to be stored. These are text files that contain the entries themselves.<br />
I&#39;m going to use /usr/local/blog-data, and set up the default blog here as well.</p>
<pre>
mkdir /usr/local/blog-data
mkdir /usr/local/blog-data/default
</pre>
<p>
<b>Step 2: Setting up a blog</b></p>
<p>now, we need to create our first blog for an LDAP user.</p>
<p>First, let&#39;s make sure that Tomcat has permission to update the settings for the default user, and for the resources folder, which is where images and theme data are stored.</p>
<pre>
chown -R appserver /Library/Tomcat/webapps/blojsom/WEB-INF/default
chown -R appserver /Library/Tomcat/webapps/blojsom/resources
</pre>
<p>I prefer to create my own template directory based upon the default that I can then use for all my users like so:</p>
<pre>
cd /Library/Tomcat/webapps/blojsom
sudo cp -Rp WEB-INF/default WEB-INF/default_template
sudo cp -Rp resources/default resources/default_template
</pre>
<p>Edit the file &#8220;blog.properties&#8221; in the WEB-INF/default_template folder so that it looks like this:</p>
<pre>
#
# blojsom user properties configuration file
#
blog-directory-depth=6
blog-language=en
blog-country=US
blog-name=BLOGOWNER
blog-description=BLOGOWNER - blog
blog-home=/usr/local/blog-data/BLOGOWNER
blog-base-url=http://myserver.mydomain.com/blojsom/
blog-url=http://myserver.mydomain.com/blojsom/blog/BLOGOWNER/
blog-file-extensions=.*html, .*txt, .*textile
blog-entry-meta-data-extension=.meta
blog-properties-extensions=.properties
blog-entries-display=15
blog-default-category-mapping=
blog-directory-filter=.*/CVS
blog-owner=BLOGOWNER
blog-owner-email=BLOGOWNER@mydomain.com
blog-comments-enabled=true
blog-comments-directory=.comments
blog-trackbacks-enabled=true
blog-trackbacks-directory=.trackbacks
blog-email-enabled=false
blog-file-encoding=
blog-blacklist-file=blacklist.filters
blog-xmlrpc-entry-extension=.html
blog-banned-ip-addresses=
blog-default-flavor=html
plugin-comment-autoformat=true
linear-navigation-enabled=false

#
# MetaWeblob extension properties
#
blojsom-extension-metaweblog-accepted-types=image/jpeg, image/jpg, image/gif, image/png, img
</pre>
<p>We&#39;ve set things up so that we will be using Apache with mod_jk for blojsom, so that users behind strict firewalls can still view the pages. If you don&#39;t want to do this, and you just want to serve these pages out using Tomcat without Apache, change the lines:</p>
<pre>
blog-base-url=http://myserver.mydomain.com/blojsom/
blog-url=http://myserver.mydomain.com/blojsom/blog/BLOGOWNER/
</pre>
<p>so that they look like:</p>
<pre>
blog-base-url=http://myserver.mydomain.com:9006/blojsom/
blog-url=http://myserver.mydomain.com:9006/blojsom/blog/BLOGOWNER/
</pre>
<p>You may also want to change the blog-owner-email property if this isn&#39;t the format of your email addresses.</p>
<p>Now we&#39;re going to copy our template blog to set up a blog for a user who exists in Open Directory with the short name &#39;odusername&#39;. Replace this with the username you wish to create a blog for.</p>
<pre>
sudo cp -Rp WEB-INF/default_template WEB-INF/odusername
sudo cp -Rp resources/default_template resources/odusername
sudo mkdir /usr/local/blog-data/odusername
sudo chown -R appserver /usr/local/blog-data/odusername
</pre>
<p>Edit odusername/blog.properties and replace all instances of &#39;BLOGOWNER&#39; with the equivalent of &#39;odusername&#39;.  If you&#39;re wondering why we&#39;ve done it like this, it is so that you can easily script creating a new user with a simple sed script, which I&#39;ll put at the end of this entry.</p>
<p>Edit odusername/authorization.properties and again, replace all instances of &#39;BLOGOWNER&#39; with the equivalent of &#39;odusername&#39;.</p>
<p>You also need to add &#39;odusername&#39; to the blojsom-users property in:</p>
<pre>
/Library/Tomcat/webapps/blojsom/WEB-INF/blojsom.properties 
</pre>
<p>like so:</p>
<pre>
blojsom-users=default,odusername
</pre>
<p><b>Step 3: Setting up mod_jk</b></p>
<p>Now, before we start up blojsom, we need to configure Apache to use mod_jk with Tomcat so that visitors can browse the blogs over port 80. If you&#39;re not planning on doing this, you can skip this whole section.</p>
<p>Open up Server Admin for your server, and in the Web service, go to the Modules tab. Enable the &#8220;jk_module&#8221; module.</p>
<p>edit the file:</p>
<pre>/etc/httpd/httpd.conf</pre>
<p>and change the section:</p>
<pre>
&lt;IfModule mod_jk.c&gt;
        JKWorkersFile /etc/httpd/workers.properties
        JKLogFile /var/log/httpd/mod_jk.log
        JKLogLevel error
        JKMount /*.jsp JBoss1
        JKMount /servlet/* JBoss1
        JKMount /examples/* JBoss1
&lt;/IfModule&gt;
</pre>
<p>to:</p>
<pre>
&lt;IfModule mod_jk.c&gt;
        JKWorkersFile /etc/httpd/workers.properties
        JKLogFile /var/log/httpd/mod_jk.log
        JKLogLevel error
        JKMount /*.jsp JBoss1
        JKMount /servlet/* JBoss1
        JKMount /examples/* JBoss1
        JKMount /blojsom/* blojsomworker
&lt;/IfModule&gt;
</pre>
<p>edit the file:</p>
<pre>/etc/httpd/workers.properties</pre>
<p>and make the following changes:<br />
Change the line:</p>
<pre>
worker.list=JBoss1, JBoss2, loadbalancer
</pre>
<p>to</p>
<pre>
worker.list=JBoss1, JBoss2, loadbalancer, blojsomworker
</pre>
<p>and after the line:</p>
<pre>
worker.loadbalancer.balanced_workers=JBoss1, JBoss2
</pre>
<p>add:</p>
<pre>
# -----------------------
# Blojsom worker
# -----------------------

worker.blojsomworker.port=9007
worker.blojsomworker.host=127.0.0.1
worker.blojsomworker.type=ajp13
worker.blojsomworker.lbfactor=100
</pre>
<p>Now check your apache config:</p>
<pre>
sudo apachectl configtest
</pre>
<p>If no errors were reported (spurious [warn messages about WebObjects are ok, just make sure you have a "Syntax Ok" result returned) then do:</p>
<pre>
sudo apachectl graceful
</pre>
<p>Try starting Tomcat. If you haven&#39;t set it up before, go to the Application Server service in Server Admin, and in the General tab, choose "Tomcat only". Save, and Start Service. It takes a little while to start up, so wait a few seconds, and hit Refresh to check that it is working.  If you&#39;ve already got Tomcat working, you can skip to the next section "Testing Blojsom".</p>
<p>To check that Tomcat is working properly, go to this page:</p>
<pre>

http://myserver.mydomain.com:9006

</pre>
<p>and click on "Servlet Examples" on the left hand side.</p>
<p>If this all seems ok, then Tomcat is fine.</p>
<p>Now to test mod_jk, try:</p>
<pre>

http://myserver.mydomain.com/examples/servlets/

</pre>
<p>If this gives you the same page, then mod_jk is working happily.</p>
<p><b>Step 4: Testing Blojsom</b></p>
<p>Now try:</p>
<pre>

http://myserver.mydomain.com/blojsom/blog/default/

</pre>
<p>to see the default blog.</p>
<p>If that all looks ok, try the blog of the Open Directory user you&#39;ve set up.</p>
<pre>

http://myserver.mydomain.com/blojsom/blog/odusername/

</pre>
<p>If that all looks ok, try logging into the admin interface for your blog.</p>
<pre>

http://myserver.mydomain.com/blojsom/blog/odusername/?flavor=admin

</pre>
<p>You should be able to login with your Open Directory username and password.</p>
<p>If that works, try adding some entries, and try switching the theme,<br />
(Plugin Settings -&gt; Configure Available Plugins -&gt; Theme Switcher Plugin)</p>
<p>If that all works, then it looks like everything is working. You now have a multi-user blog server set up, and have create a blog for a user that authenticates against Open Directory.</p>
<p></p>
<p>Now, if you want an easy way to have this automatically set up blogs for your OD users, you might want to look at a script like this:</p>
<p>This version loops over the listing of a folder. I&#39;ve done this one this way, as this allows me to quickly loop over all these users who are logically grouped, without having to actually interrogate the Open Directory server for group memberships. The &#39;grep -e&#39; statement that the ls gets piped through is there to preclude those pesky ".DS_Store" and ".VolumeIcon.icns" files, as well as my group shared folders, which all start with uppercase characters.</p>
<pre>
#!/bin/sh
#
BLOJHOME=/Library/Tomcat/webapps/blojsom
for user in $(ls /Volumes/raid/mystaff | grep -e "^[a-z]&#8220;)
do 
  if [ ! -e $BLOJHOME/WEB-INF/$user ]
  then
    cp -Rp $BLOJHOME/WEB-INF/default_template $BLOJHOME/WEB-INF/$user
    cp -Rp $BLOJHOME/resources/default_template $BLOJHOME/resources/$user
    mkdir -p /usr/local/blog-data/$user
    cat $BLOJHOME/WEB-INF/default_template/blog.properties | sed &#8220;s|BLOGOWNER|$user|g&#8221; &gt; $BLOJHOME/WEB-INF/$user/blog.properties
    cat $BLOJHOME/WEB-INF/default_template/authorization.properties | sed &#8220;s|BLOGOWNER|$user|g&#8221; &gt; $BLOJHOME/WEB-INF/$user/authorization.properties
    cat $BLOJHOME/WEB-INF/default_template/permissions.properties | sed &#8220;s|BLOGOWNER|$user|g&#8221; &gt; $BLOJHOME/WEB-INF/$user/permissions.properties
    chown appserver $BLOJHOME/WEB-INF/$user/blog.properties
    chown appserver /usr/local/blog-data/$user
    if [ ! $(cat $BLOJHOME/WEB-INF/blojsom.properties | grep $user) ]
    then
      BLOJUSERS=$(cat $BLOJHOME/WEB-INF/blojsom.properties | grep blojsom-users)
      cat $BLOJHOME/WEB-INF/blojsom.properties | grep -v blojsom-users &gt;  /tmp/blojsom.properties
      echo &#8220;$BLOJUSERS,$user&#8221; &gt;&gt; /tmp/blojsom.properties
      cp /tmp/blojsom.properties $BLOJHOME/WEB-INF/blojsom.properties
    fi
  fi
done

serveradmin stop appserver &amp;&amp; serveradmin start appserver
</pre>
<p>If you really do want to loop over all the users in your Open Directory setup, you could change the for loop to something like:</p>
<pre>
for user in $(dscl /LDAPv3/odmaster.mydomain.com -list /Users)
</pre>
<p>but you&#39;ll probably want to filter out some users like unknown and maybe your OD Dir Admin account.</p>
<pre>
for user in $(dscl /LDAPv3/odmaster.mydomain.com -list /Users | grep -v unknown | grep -v myodadmin)
</pre>
<p>You could do that more elegantly in the script by checking the username, rather than just grepping, but that works...<br />
<br />
This is kind of why I like looping over sharepoints. I know that all the users in a certain group who should have this service will be in one of several sharepoints, and it&#39;s kind of easier. If they don&#39;t have a home directory yet, they shouldn&#39;t be blogging yet either... </p>
<p>So this is how I&#39;m running this blog, and have set up blogs for all my staff. As always though, buyer beware, especially when it&#39;s free... standard not responsible for destroying your server disclaimer here.</p>
			</div><!-- .entry-content -->
	
	<footer class="entry-meta">
					<div class="comments-link">
				<a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2005/01/14/blojsom-and-open-directory-authentication/#respond" title="Comment on blojsom and Open Directory authentication."><span class="leave-reply">Leave a comment</span></a>			</div><!-- .comments-link -->
		
			</footer><!-- .entry-meta -->
</article><!-- #post -->
			
			
		
		</div><!-- #content -->
	</div><!-- #primary -->


		</div><!-- #main -->
		<footer id="colophon" class="site-footer" role="contentinfo">
				<div id="secondary" class="sidebar-container" role="complementary">
		<div class="widget-area">
			<aside id="pages-2" class="widget widget_pages"><h3 class="widget-title">Pages</h3>		<ul>
			<li class="page_item page-item-2"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/about/">About/Contact</a></li>
<li class="page_item page-item-278"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/os-x-puppet-pkgs/">OS X Puppet pkgs</a></li>
		</ul>
		</aside><aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="http://explanatorygap.net/wp-content/plugins/really-static/static/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" title="Search for:" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside><aside id="tweetbox" class="widget tweetbox_widget"><h3 class="widget-title">Latest Tweets</h3><script type="text/javascript" src="http://explanatorygap.net/wp-content/plugins/tweetbox/tweetbox.js"></script><script>getTweets('nigelkersten', 3, '')</script><div id="tweetboxtweets">Fetching latest tweets...</div></aside><aside id="categories-1" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-5"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/nix/" title="View all posts filed under *nix">*nix</a>
</li>
	<li class="cat-item cat-item-6"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/macosx/" title="View all posts filed under macosx">macosx</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/macosxserver/" title="View all posts filed under macosxserver">macosxserver</a>
</li>
	<li class="cat-item cat-item-13"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/puppet/" title="View all posts filed under puppet">puppet</a>
</li>
	<li class="cat-item cat-item-15"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/python/" title="View all posts filed under python">python</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/ramblings/" title="View all posts filed under ramblings">ramblings</a>
</li>
	<li class="cat-item cat-item-2"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/snippets/" title="Snippets">Snippets</a>
</li>
	<li class="cat-item cat-item-7"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/software-and-scripts/" title="View all posts filed under software and scripts">software and scripts</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/uncategorized/" title="View all posts filed under Uncategorized">Uncategorized</a>
</li>
		</ul>
</aside><aside id="meta-2" class="widget widget_meta"><h3 class="widget-title">Meta</h3>			<ul>
						<li><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/wp-login.php">Log in</a></li>
			<li><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/feed/" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/comments/feed/" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
</aside><aside id="linkcat-10" class="widget widget_links"><h3 class="widget-title">Mac Dev Blogs</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://ridiculousfish.com/blog/">Ridiculous Fish</a></li>
<li><a href="http://www.theocacao.com/" title="Scott Stevenson&#8217;s blog">theocacao.com</a></li>

	</ul>
</aside>
<aside id="linkcat-8" class="widget widget_links"><h3 class="widget-title">Mac Tech Blogs</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://bynkii.com/" title="John C. Welch&#8217;s blog&#8230; the reason God invented the middle finger&#8230;">bynkii.com</a></li>
<li><a href="http://arstechnica.com/staff/fatbits.ars" title="John Siracusa&#8217;s Journal">fatbits</a></li>
<li><a href="http://iamleeg.blogspot.com/" title="Graham Lee&#8217;s blog&#8230; lots of Darwin and Openstep.">i am leeg</a></li>
<li><a href="http://managingosx.wordpress.com/" title="Greg Neagle&#8217;s Managing OS X blog">managing os x</a></li>
<li><a href="http://northstarlabs.net" title="Jeff McCune&#8217;s sysadmin blog">northstarlabs.net</a></li>
<li><a href="http://www.radiotope.com/writing/" title="Edward Marczak&#8217;s blog&#8230; the oneness of tech..">tech zendo</a></li>
<li><a href="http://www.dreness.com/blog/" title="Andre&#8217;s Mac geek blog&#8230;">the bits</a></li>
<li><a href="http://yourmacguy.wordpress.com/" title="Peter Bukowinski&#8217;s blog">Your Mac Guy</a></li>

	</ul>
</aside>
<aside id="linkcat-9" class="widget widget_links"><h3 class="widget-title">Mac Technical Sites</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://www.afp548.com" title="We put the M in RTFM&#8230;">AFP548.com</a></li>
<li><a href="http://www.macenterprise.org" title="The MacEnterprise project is a community of IT professionals sharing information and solutions to support Macs in an enterprise.">MacEnterprise.org</a></li>
<li><a href="http://xsanity.com/">xsanity</a></li>

	</ul>
</aside>
<aside id="linkcat-12" class="widget widget_links"><h3 class="widget-title">Social</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://yumamino.com/" title="Tane Potaka&#8217;s blog">Yumamino</a></li>

	</ul>
</aside>
		</div><!-- .widget-area -->
	</div><!-- #secondary -->

			<div class="site-info">
								<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- #colophon -->
	</div><!-- #page -->

	<script type='text/javascript' src='http://explanatorygap.net/wp-includes/js/masonry.min.js?ver=3.1.2'></script>
<script type='text/javascript' src='http://explanatorygap.net/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2'></script>
<script type='text/javascript' src='http://explanatorygap.net/wp-content/themes/twentythirteen/js/functions.js?ver=2013-07-18'></script>
</body>
</html>
<!-- Dynamic Page Served (once) in 0.282 seconds -->
