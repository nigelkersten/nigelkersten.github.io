<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>10 | May | 2010 | mind the explanatory gap</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
		<!--[if lt IE 9]>
	<script src="http://explanatorygap.net/wp-content/themes/twentythirteen/js/html5.js"></script>
	<![endif]-->
	<link rel="alternate" type="application/rss+xml" title="mind the explanatory gap &raquo; Feed" href="http://explanatorygap.net/wp-content/plugins/really-static/static/feed/" />

<link rel='stylesheet' id='wpcf-css'  href='http://explanatorygap.net/wp-content/plugins/wp-contact-form/wpcf.css?ver=20110218' type='text/css' media='all' />
<link rel='stylesheet' id='twentythirteen-fonts-css'  href='//fonts.googleapis.com/css?family=Source+Sans+Pro%3A300%2C400%2C700%2C300italic%2C400italic%2C700italic%7CBitter%3A400%2C700&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='http://explanatorygap.net/wp-content/themes/twentythirteen/fonts/genericons.css?ver=2.09' type='text/css' media='all' />
<link rel='stylesheet' id='twentythirteen-style-css'  href='http://explanatorygap.net/wp-content/themes/twentythirteen/style.css?ver=2013-07-18' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentythirteen-ie-css'  href='http://explanatorygap.net/wp-content/themes/twentythirteen/css/ie.css?ver=2013-07-18' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='http://explanatorygap.net/wp-includes/js/jquery/jquery.js?ver=1.11.0'></script>
<script type='text/javascript' src='http://explanatorygap.net/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://explanatorygap.net/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.7.3'></script>
<meta name="generator" content="WordPress 3.9.1 - really-static 0.5" />
<link rel="stylesheet" href="http://explanatorygap.net/wp-content/plugins/source-code-syntax-highlighting-plugin-for-wordpress/geshi.css"  type="text/css" />	<style type="text/css" id="twentythirteen-header-css">
			.site-header {
			background: url(http://explanatorygap.net/wp-content/themes/twentythirteen/images/headers/star.png) no-repeat scroll top;
			background-size: 1600px auto;
		}
		</style>
	<!-- Google Analytics Tracking by Google Analyticator 6.4.7.3: http://www.videousermanuals.com/google-analyticator/ -->
<script type="text/javascript">
                var analyticsFileTypes = [''];
                            var analyticsSnippet = 'enabled';
                var analyticsEventTracking = 'enabled';
            </script>
<script type="text/javascript">
	var _gaq = _gaq || [];
  
	_gaq.push(['_setAccount', 'UA-719433-1']);
    _gaq.push(['_addDevId', 'i9k95']); // Google Analyticator App ID with Google
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</head>

<body class="archive date single-author">
	<div id="page" class="hfeed site">
		<header id="masthead" class="site-header" role="banner">
			<a class="home-link" href="http://explanatorygap.net/wp-content/plugins/really-static/static/" title="mind the explanatory gap" rel="home">
				<h1 class="site-title">mind the explanatory gap</h1>
				<h2 class="site-description">many a slip &#039;twixt mind and lip&#8230;</h2>
			</a>

			<div id="navbar" class="navbar">
				<nav id="site-navigation" class="navigation main-navigation" role="navigation">
					<h3 class="menu-toggle">Menu</h3>
					<a class="screen-reader-text skip-link" href="#content" title="Skip to content">Skip to content</a>
					<div class="nav-menu"><ul><li class="page_item page-item-2"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/about/">About/Contact</a></li><li class="page_item page-item-278"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/os-x-puppet-pkgs/">OS X Puppet pkgs</a></li></ul></div>
					<form role="search" method="get" class="search-form" action="http://explanatorygap.net/wp-content/plugins/really-static/static/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" title="Search for:" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form>				</nav><!-- #site-navigation -->
			</div><!-- #navbar -->
		</header><!-- #masthead -->

		<div id="main" class="site-main">

	<div id="primary" class="content-area">
		<div id="content" class="site-content" role="main">

					<header class="archive-header">
				<h1 class="archive-title">Daily Archives: May 10, 2010</h1>
			</header><!-- .archive-header -->

										
<article id="post-256" class="post-256 post type-post status-publish format-standard hentry category-nix category-python category-ramblings category-snippets">
	<header class="entry-header">
		
				<h1 class="entry-title">
			<a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2010/05/10/python-subprocess-over-shell/" rel="bookmark">python subprocess over shell</a>
		</h1>
		
		<div class="entry-meta">
			<span class="date"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2010/05/10/python-subprocess-over-shell/" title="Permalink to python subprocess over shell" rel="bookmark"><time class="entry-date" datetime="2010-05-10T14:16:54+00:00">May 10, 2010</time></a></span><span class="categories-links"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/nix/" title="View all posts in *nix" rel="category tag">*nix</a>, <a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/python/" title="View all posts in python" rel="category tag">python</a>, <a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/ramblings/" title="View all posts in ramblings" rel="category tag">ramblings</a>, <a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/snippets/" title="View all posts in Snippets" rel="category tag">Snippets</a></span><span class="author vcard"><a class="url fn n" href="http://explanatorygap.net/wp-content/plugins/really-static/static/author/nigelkersten/" title="View all posts by nigel kersten" rel="author">nigel kersten</a></span>					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

		<div class="entry-content">
		<p>One of my common gripes is when people struggle with complicated shell scripts that would be much simpler in a scripting language like Python, Ruby or Perl. I used to abuse PHP for this, but saw the light.</p>
<p>If you&#8217;re talking about replacing shell scripts, all of these are pretty much equivalent, but I don&#8217;t really do Perl for no particular reason, I&#8217;m a big fan of Python for general purpose work just because of the rich module system, and at least <a href="http://python.org/about/quotes/">&#8220;dozens of engineers&#8221; use it at work.</a>.</p>
<p>The reason we generally write shell scripts is because we want to execute a bunch of external processes in an automated way. </p>
<p>In this area you can whip something basic up fastest in shell, yes, but at some point you&#8217;re going to have to repay that <a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2009/10/02/the-complexity-debt/">technical debt</a> if you need to get past a certain point.</p>
<p>Besides, <a href="http://mywiki.wooledge.org/BashPitfalls">it&#8217;s not like shell scripting always stays simple and easy</a>&#8230; and the overhead of moving to a more powerful language isn&#8217;t that huge.</p>
<p>If I&#8217;m sure the scope of a script will be small, or I don&#8217;t have the option of moving to structured data format for input and output with external commands, or I don&#8217;t have to futz around with arrays, I&#8217;ll stick with bash.</p>
<p>But, if I want to work with dictionary objects or talk in a protocol like LDAP or model things as objects, or need complex handling and passing around of stdin/stdout/exit statuses, or know some module handles lots of edge cases for me, I&#8217;ll move to Python or Ruby.  I quite like both, but feel that Python is more utilitarian, and simply due to whitespace enforcement and <a href="http://www.logilab.org/857">extensive linters</a> is a good fit for code that may need to be picked up and understood quickly by a co-worker.</p>
<p>When it comes to getting started with Python, I still suggest <a href="http://www.diveintopython.org/">Dive into Python</a> for people. Just flipping through Chapters 1-3 equips you with an awful lot.</p>
<p>Anyway, some people think Python is hard, but it&#8217;s not really. I think of Python as being extremely utilitarian, which makes it a great fit for sysadmin work.</p>
<p>Someone posted on the <a href="http://www.macenterprise.org">MacEnterprise</a> list a question about working out what PPD was in use by each printer on the system in OS X, and someone gave a good shell example using the usual suspects of for, grep and awk.</p>
<p>There&#8217;s nothing really wrong with doing this, but I&#8217;ve come to distrust parsing non-structured output if I need to keep this solution working across many multiple versions of operating systems, or even between OS X major versions given Apple&#8217;s history.  One of the big advantages of moving to Python is being able to parse and manipulate property lists, which can get really painful in shell.  You end up writing out lots of temp files or giving up on dealing with error conditions. </p>
<p>Anyway, so lets see what it&#8217;s like executing a command in Python with the subprocess module. We&#8217;re asking System Profiler for printer info, and telling it to return the output in XML plist format.</p>
<div class="dean_ch" style="white-space: wrap;"><span class="co1">#!/usr/bin/python</span></p>
<p><span class="kw1">import</span> <span class="kw3">subprocess</span></p>
<p>
command = <span class="br0">&#91;</span><span class="st0">&#8216;system_profiler&#8217;</span>, <span class="st0">&#8216;-xml&#8217;</span>, <span class="st0">&#8216;SPPrintersDataType&#8217;</span><span class="br0">&#93;</span><br />
task = <span class="kw3">subprocess</span>.<span class="me1">Popen</span><span class="br0">&#40;</span>command,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stdout=<span class="kw3">subprocess</span>.<span class="me1">PIPE</span>,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stderr=<span class="kw3">subprocess</span>.<span class="me1">PIPE</span><span class="br0">&#41;</span></p>
<p><span class="br0">&#40;</span>stdout, stderr<span class="br0">&#41;</span> = task.<span class="me1">communicate</span><span class="br0">&#40;</span><span class="br0">&#41;</span><br />
<span class="kw1">print</span> stdout</div>
<p>To skim through those lines, we&#8217;re</p>
<ul>
<li>setting the python shebang</li>
<li>importing the subprocess module</li>
<li>defining a list called &#8216;command&#8217; to store the command we want to run</li>
<li>creating a subprocess Popen object to run our command called &#8216;task&#8217;</li>
<li>setting standard out and standard error to go to our own pipes</li>
<li>getting standard out and standard error from the task.</li>
<li>printing standard out</li>
</ul>
<p>This really isn&#8217;t much work, and if you really only wanted this functionality, there are other <a href="http://docs.python.org/library/subprocess.html#convenience-functions">convenience functions</a> that you can use to make this even shorter, or write your own convenience function.</p>
<p>But we have all sorts of options now.</p>
<p>We can send standard input to the task:</p>
<div class="dean_ch" style="white-space: wrap;"><span class="br0">&#40;</span>stdout, stderr<span class="br0">&#41;</span> = task.<span class="me1">communicate</span><span class="br0">&#40;</span>stdin<span class="br0">&#41;</span></div>
<p>We can ask what the exit status is easily:</p>
<div class="dean_ch" style="white-space: wrap;">status = task.<span class="me1">returncode</span></div>
<p>and if we get None we know the process hasn&#8217;t terminated yet.</p>
<p>And if we want to do something a bit more complicated we can search through the structured data plist output easily like:</p>
<div class="dean_ch" style="white-space: wrap;"><span class="co1">#!/usr/bin/python</span></p>
<p><span class="kw1">import</span> plistlib<br />
<span class="kw1">import</span> <span class="kw3">subprocess</span></p>
<p>
command = <span class="br0">&#91;</span><span class="st0">&#8216;system_profiler&#8217;</span>, <span class="st0">&#8216;-xml&#8217;</span>, <span class="st0">&#8216;SPPrintersDataType&#8217;</span><span class="br0">&#93;</span><br />
task = <span class="kw3">subprocess</span>.<span class="me1">Popen</span><span class="br0">&#40;</span>command,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stdout=<span class="kw3">subprocess</span>.<span class="me1">PIPE</span>,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stderr=<span class="kw3">subprocess</span>.<span class="me1">PIPE</span><span class="br0">&#41;</span></p>
<p><span class="br0">&#40;</span>stdout, stderr<span class="br0">&#41;</span> = task.<span class="me1">communicate</span><span class="br0">&#40;</span><span class="br0">&#41;</span><br />
printers = plistlib.<span class="me1">readPlistFromString</span><span class="br0">&#40;</span>stdout<span class="br0">&#41;</span><br />
printers = printers<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="st0">&#8216;_items&#8217;</span><span class="br0">&#93;</span></p>
<p><span class="kw1">for</span> printer <span class="kw1">in</span> printers:<br />
&nbsp; <span class="kw1">print</span> <span class="st0">&#8216;Name: &#8216;</span> + printer<span class="br0">&#91;</span><span class="st0">&#8216;_name&#8217;</span><span class="br0">&#93;</span><br />
&nbsp; <span class="kw1">print</span> <span class="st0">&#8216;PPD: &#8216;</span> + printer<span class="br0">&#91;</span><span class="st0">&#8216;ppd&#8217;</span><span class="br0">&#93;</span><br />
&nbsp;</div>
<p>This is easier to extend than the standard for/grep/awk/sed equivalents tend to be, and much easier for a co-worker to pick up and understand. It comes close to documenting itself, just needs some comments about the structure of Apple&#8217;s output, and some try/except blocks in case the output is malformed or does change.</p>
			</div><!-- .entry-content -->
	
	<footer class="entry-meta">
					<div class="comments-link">
				<a href="http://explanatorygap.net/wp-content/plugins/really-static/static/2010/05/10/python-subprocess-over-shell/#comments" title="Comment on python subprocess over shell">View all 3 comments</a>			</div><!-- .comments-link -->
		
			</footer><!-- .entry-meta -->
</article><!-- #post -->
			
			
		
		</div><!-- #content -->
	</div><!-- #primary -->


		</div><!-- #main -->
		<footer id="colophon" class="site-footer" role="contentinfo">
				<div id="secondary" class="sidebar-container" role="complementary">
		<div class="widget-area">
			<aside id="pages-2" class="widget widget_pages"><h3 class="widget-title">Pages</h3>		<ul>
			<li class="page_item page-item-2"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/about/">About/Contact</a></li>
<li class="page_item page-item-278"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/os-x-puppet-pkgs/">OS X Puppet pkgs</a></li>
		</ul>
		</aside><aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="http://explanatorygap.net/wp-content/plugins/really-static/static/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" title="Search for:" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside><aside id="tweetbox" class="widget tweetbox_widget"><h3 class="widget-title">Latest Tweets</h3><script type="text/javascript" src="http://explanatorygap.net/wp-content/plugins/tweetbox/tweetbox.js"></script><script>getTweets('nigelkersten', 3, '')</script><div id="tweetboxtweets">Fetching latest tweets...</div></aside><aside id="categories-1" class="widget widget_categories"><h3 class="widget-title">Categories</h3>		<ul>
	<li class="cat-item cat-item-5"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/nix/" title="View all posts filed under *nix">*nix</a>
</li>
	<li class="cat-item cat-item-6"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/macosx/" title="View all posts filed under macosx">macosx</a>
</li>
	<li class="cat-item cat-item-3"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/macosxserver/" title="View all posts filed under macosxserver">macosxserver</a>
</li>
	<li class="cat-item cat-item-13"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/puppet/" title="View all posts filed under puppet">puppet</a>
</li>
	<li class="cat-item cat-item-15"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/python/" title="View all posts filed under python">python</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/ramblings/" title="View all posts filed under ramblings">ramblings</a>
</li>
	<li class="cat-item cat-item-2"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/snippets/" title="Snippets">Snippets</a>
</li>
	<li class="cat-item cat-item-7"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/software-and-scripts/" title="View all posts filed under software and scripts">software and scripts</a>
</li>
	<li class="cat-item cat-item-1"><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/category/uncategorized/" title="View all posts filed under Uncategorized">Uncategorized</a>
</li>
		</ul>
</aside><aside id="meta-2" class="widget widget_meta"><h3 class="widget-title">Meta</h3>			<ul>
						<li><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/wp-login.php">Log in</a></li>
			<li><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/feed/" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://explanatorygap.net/wp-content/plugins/really-static/static/comments/feed/" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
</aside><aside id="linkcat-10" class="widget widget_links"><h3 class="widget-title">Mac Dev Blogs</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://ridiculousfish.com/blog/">Ridiculous Fish</a></li>
<li><a href="http://www.theocacao.com/" title="Scott Stevenson&#8217;s blog">theocacao.com</a></li>

	</ul>
</aside>
<aside id="linkcat-8" class="widget widget_links"><h3 class="widget-title">Mac Tech Blogs</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://bynkii.com/" title="John C. Welch&#8217;s blog&#8230; the reason God invented the middle finger&#8230;">bynkii.com</a></li>
<li><a href="http://arstechnica.com/staff/fatbits.ars" title="John Siracusa&#8217;s Journal">fatbits</a></li>
<li><a href="http://iamleeg.blogspot.com/" title="Graham Lee&#8217;s blog&#8230; lots of Darwin and Openstep.">i am leeg</a></li>
<li><a href="http://managingosx.wordpress.com/" title="Greg Neagle&#8217;s Managing OS X blog">managing os x</a></li>
<li><a href="http://northstarlabs.net" title="Jeff McCune&#8217;s sysadmin blog">northstarlabs.net</a></li>
<li><a href="http://www.radiotope.com/writing/" title="Edward Marczak&#8217;s blog&#8230; the oneness of tech..">tech zendo</a></li>
<li><a href="http://www.dreness.com/blog/" title="Andre&#8217;s Mac geek blog&#8230;">the bits</a></li>
<li><a href="http://yourmacguy.wordpress.com/" title="Peter Bukowinski&#8217;s blog">Your Mac Guy</a></li>

	</ul>
</aside>
<aside id="linkcat-9" class="widget widget_links"><h3 class="widget-title">Mac Technical Sites</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://www.afp548.com" title="We put the M in RTFM&#8230;">AFP548.com</a></li>
<li><a href="http://www.macenterprise.org" title="The MacEnterprise project is a community of IT professionals sharing information and solutions to support Macs in an enterprise.">MacEnterprise.org</a></li>
<li><a href="http://xsanity.com/">xsanity</a></li>

	</ul>
</aside>
<aside id="linkcat-12" class="widget widget_links"><h3 class="widget-title">Social</h3>
	<ul class='xoxo blogroll'>
<li><a href="http://yumamino.com/" title="Tane Potaka&#8217;s blog">Yumamino</a></li>

	</ul>
</aside>
		</div><!-- .widget-area -->
	</div><!-- #secondary -->

			<div class="site-info">
								<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
			</div><!-- .site-info -->
		</footer><!-- #colophon -->
	</div><!-- #page -->

	<script type='text/javascript' src='http://explanatorygap.net/wp-includes/js/masonry.min.js?ver=3.1.2'></script>
<script type='text/javascript' src='http://explanatorygap.net/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2'></script>
<script type='text/javascript' src='http://explanatorygap.net/wp-content/themes/twentythirteen/js/functions.js?ver=2013-07-18'></script>
</body>
</html>
<!-- Dynamic Page Served (once) in 0.276 seconds -->
